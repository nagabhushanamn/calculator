pipeline {
     agent any
     stages {
        stage("Checkout") {
            steps {
                git url: 'https://github.com/nagabhushanamn/calculator.git'
            }
          }
        stage("Compile") {
		    steps {
                script{
                    def project = 'web-calculator'
                    dir(project){
                    		sh "./gradlew compileJava"    
                    }
                }
		    }
		}
		stage("Unit test") {
			steps{
			    script{
                    def project = 'web-calculator'
                    dir(project){
                    		sh "./gradlew test"    
                    }
                }
			}
		}
		stage("Code coverage") {
		    steps {
		       script{
                    def project = 'web-calculator'
                    dir(project){
				        sh "./gradlew jacocoTestReport"
                        publishHTML (target: [
                            reportDir: 'build/reports/jacoco/test/html',
                            reportFiles: 'index.html',
                            reportName: "JaCoCo Report"
                        ])
				        sh "./gradlew jacocoTestCoverageVerification"
				    }
		         }
		     }
		}
        stage("Static code analysis") {
            steps {
                script{
                    def project = 'web-calculator'
                    dir(project){
                         sh "./gradlew checkstyleMain"
                    }
                 }
            }     
        }
     }
}